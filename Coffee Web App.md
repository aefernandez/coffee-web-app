# Coffee Web App #
The Coffee Web App is a project that enhances a Lelit PL41TEM espresso machine by adding a smart scale as well as remote control through a web app. 

## Introduction ##
The Lelit PL41TEM is a manual, entry-level espresso machine. It already features a PID temperature controller, but it lacks some extra features that would enhance the espresso making experience. These features include espresso shot weight and brew time. Together, these features allow for a basic level of espresso profiling.

Espresso profiling typically refers to the control of the pressure generated by the espresso machine. This allows for more complicated espresso recipes that claim to unlock greater consistency in results. In the context of this project, espresso profiling refers to the overall profile of the espresso shot. More specifically, it will refer to brew time, temperature and weight. Monitoring these variables is part of the basic espresso technique and by collecting these variables over time, it should be possible to achieve more consistent results. Thus, the project has the following goals:

1. Enable some level of profiling of the espresso shots 
2. Accurate repeatability of espresso shots 

The following sections will describe the requirements and design of the system in further detail. 

## Customer Requirements ##
The following section captures the requirements of the app and the system. 

1. The user can control the pump of the espresso machine through the app. 
2. The user can see the weight of the shot in realtime.
3. The user can see the brewing time in realtime.
4. The user can access past brew data through the app.
5. The user can manually operate the machine when the app is not actively controlling the machine. 
6. The user can the app to automatically turn on/off the espresso machine.
7. The user can see if the espresso machine is turned on through the app
8. The user can see if the espresso machine is hot in the app.
9. The user can use the physical power switch to turn off the machine independent of the app. 
10. The user cannot change the mode of the espresso machine through the app.
11. The user cannot turn on the pump if the machine is not in espresso mode.
12. The user cannot access the web app outside of the local network. 

## Technical Requirements ##

1. A web server must run on the local network to host the app.
2. Port forwarding is disabled to prohibit access to the app from outside the local network. 
3. The network enabled outlet must be rated for 120V, 4A+.
4. The raspberry pi must be placed outside of the espresso machine in order to retain connectivity to the wifi network as the machine housing acts as a shield. 
5. The Raspberry Pi has to be connected to the Heat LED of the machine to display the heat status of the machine.
   
## System Design ##

### Control of the Pump ###
The user will have the ability to turn the pump on and off through a button in the app. When the user presses the button, the app will interact with the Raspberry Pi, which will control a board that will turn on and off the pump of the machine. 

```plantuml
@startuml
    actor User
    participant App
    participant Control Module as cmod
    participant Pump

    User --> App: Tap pump on button
    App --> cmod: Toggle pump on/off
    cmod --> pump: Power on/off    
@enduml
```

### Control of the Espresso Machine ###
Similarly, the espresso machine can be turned on and off through the app. The user will interact with a button that will communicate with the raspberry pi which will in turn control a smart outlet to power the machine on and off. The ability for the app to power the machine on depends on the physical switch of the machine being set to on as well. As stated in the user requirements, the user has the ability to override the power of the machine with the physical on/off switch. 

```plantuml
@startuml
    actor User
    participant App
    participant Control Module as cmod
    participant Pump

    User --> App: Tap button to start brewing automatically
    App --> rpi: Get weight measurement
    rpi --> App: Current weight
    App --> cmod: Toggle pump on
    alt
    App --> App: Countdown predefined brew time
    App --> App: Wait until the weight reaches predefined amount
    end 
    App --> cmod: Toggle pump off 
@enduml
```

## Software Design ##


## Lessons Learned ##